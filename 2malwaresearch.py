#!/usr/bin/python
# -*- coding: UTF-8 -*-

from bs4 import BeautifulSoup
import urllib2
import sys
import time
import argparse

parser = argparse.ArgumentParser(description='MalwareSearch 0.1\t[github.com/MalwareReverseBrasil/malwaresearch.git]')
parser.add_argument('-f','--find',required=True,help='Enter your search via MD5, SHA1, SHA256 or an Common Signature name.',action='store')
parser.add_argument('-w','--write',help='',action='store')
parser.add_argument('-o','--output',help='',action='store')
parser.add_argument('-d','--download',help='',action='store')
parser.add_argument('-hs','--hash',help='',action='store')

args = parser.parse_args()

t1 = time.time()

if args.find:
    host = 'http://openmalware.org'
    address = '/search.cgi?search=' 
    malfind = args.find
    site = host+address+malfind

def download(url):
    print('Starting MalwareSearch ...')
    try:
        html = urllib2.urlopen(url).read()
    except urllib2.URLError as e:
        print ('Sorry, download error:', e.reason)
        html = None
    return html

url = download(site)
soup = BeautifulSoup(url,'lxml')

try:
    founds = soup.find('h3').string
except:
    print('Error: Search too short')
    sys.exit(0)


print('\033[1;31m\n\t\t' + founds + '\n\033[0m')
print('This is the first result!\n')

for i in range(0,6):
    try:
        name = soup('b')[i].string 
         
        tr = soup(attrs={'id':'checksum'})[i]
        area = tr.text.strip('\n')

        if (name == 'Original Filename:'):
            print('\033[1;32m' + name + '\t' + area + '\033[0m')
        elif (name == 'Added:'):
            td1 = soup('td')[i+6].string.strip('\n')
            print(name + '\t\t\t' + td1)
        else:
            print(name + '\t\t\t' + area)
    except:
        break
    
t2 = time.time()
total_time = t2-t1
print('\n\nTotal search time %.2f seconds' %total_time)
